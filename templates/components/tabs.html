<!-- Bottom Tabs - Fixed at bottom -->
<nav class="fixed bottom-0 left-0 right-0 bg-gray-50 border-t border-gray-300 shadow-lg">
    <div class="flex">
        <!-- Tab Procesar -->
        <button
            onclick="switchTab('process')"
            class="flex-1 py-3 text-center border-r border-gray-200 hover:bg-gray-100 transition-colors bg-blue-600 text-white"
            id="tab-process">
            <div class="text-2xl">üè†</div>
            <div class="text-xs font-medium">Procesar</div>
        </button>

        <!-- Tab Ver Inventario -->
        <button
            onclick="switchTab('inventory')"
            class="flex-1 py-3 text-center hover:bg-gray-100 transition-colors"
            id="tab-inventory">
            <div class="text-2xl">üì¶</div>
            <div class="text-xs font-medium">Ver</div>
        </button>
    </div>
</nav>

<script>
    // Sistema de cache de tabs
    const tabCache = {
        loaded: { process: false, inventory: false },
        loading: { process: false, inventory: false }
    };

    /**
     * Carga contenido de un tab via HTMX
     * @param {string} tabName - Nombre del tab ('process' o 'inventory')
     * @param {boolean} forceReload - Si true, ignora el cache
     */
    function loadTabContent(tabName, forceReload = false) {
        if (forceReload || (!tabCache.loaded[tabName] && !tabCache.loading[tabName])) {
            tabCache.loading[tabName] = true;

            return htmx.ajax('GET', '/app/' + tabName, {
                target: '#view-' + tabName,
                swap: 'innerHTML'
            }).then(() => {
                tabCache.loaded[tabName] = true;
                tabCache.loading[tabName] = false;
            });
        }
        return Promise.resolve();
    }

    function switchTab(tabName) {
        // Ocultar todos los tabs
        document.getElementById('view-process').classList.add('hidden');
        document.getElementById('view-inventory').classList.add('hidden');

        // Actualizar estilos de botones
        document.getElementById('tab-process').classList.remove('bg-blue-600', 'text-white');
        document.getElementById('tab-inventory').classList.remove('bg-blue-600', 'text-white');

        const activeButton = document.getElementById('tab-' + tabName);
        activeButton.classList.add('bg-blue-600', 'text-white');

        // Mostrar tab seleccionado
        const targetView = document.getElementById('view-' + tabName);
        targetView.classList.remove('hidden');

        // Cargar contenido si no est√° cacheado
        loadTabContent(tabName);
    }

    // Escuchar evento de invalidaci√≥n de cache del inventario
    document.body.addEventListener('inventoryUpdated', function() {
        // Marcar inventario como no cargado para forzar recarga
        tabCache.loaded.inventory = false;

        // Recargar contenido del tab inventario si est√° visible
        const inventoryView = document.getElementById('view-inventory');
        if (!inventoryView.classList.contains('hidden')) {
            loadTabContent('inventory', true);
        }
    });

    // Precargar inventario en background despu√©s de que cargue la p√°gina
    window.addEventListener('load', function() {
        // Esperar 500ms para no bloquear la carga inicial del tab "Procesar"
        setTimeout(function() {
            loadTabContent('inventory');
        }, 500);
    });
</script>
