<!-- Vista de Procesamiento de Texto -->
<div class="max-w-2xl mx-auto">
    <h2 class="text-xl font-semibold mb-4 text-blue-600">Dicta tus cambios</h2>

    <form
        hx-post="/process/text"
        hx-target="#feedback"
        hx-swap="innerHTML"
        hx-indicator="#loading"
        class="space-y-4"
        id="process-form">

        <!-- Textarea grande para dictar -->
        <textarea
            name="text"
            rows="15"
            placeholder="Ejemplo: AgreguÃ© 2 kilos de arroz al almacÃ©n 1 y quedan 3 huevos en el refrigerador..."
            class="w-full p-4 border-2 border-blue-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-600 resize-none"
            required></textarea>

        <!-- Campo hidden para el contexto -->
        <input type="hidden" name="context" id="context-input">

        <!-- BotÃ³n procesar -->
        <button
            type="submit"
            class="w-full bg-blue-600 text-white py-4 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-all flex items-center justify-center gap-2"
            id="process-btn">
            ðŸŽ¤ Procesar Texto
            <div id="loading" class="htmx-indicator">
                {% include 'components/loading.html' %}
            </div>
        </button>
    </form>

    <!-- Feedback de cambios -->
    <div id="feedback" class="mt-6"></div>
</div>

<script>
    // Cargar contexto solo una vez (si no estÃ¡ cargado ya)
    if (!window.contextLoaded) {
        setTimeout(function() {
            htmx.ajax('GET', '/inventory/api/context', {
                target: 'body',
                swap: 'beforeend'
            });
        }, 500);
    }

    // Inyectar contexto antes de enviar el form
    document.getElementById('process-form').addEventListener('htmx:configRequest', function(evt) {
        if (window.contextLoaded && window.inventoryContext) {
            evt.detail.parameters.context = JSON.stringify(window.inventoryContext);
        }
    });
</script>
